<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MLP Editor Test</title>
    <link rel="stylesheet" href="assets/css/mlp-editor.css">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #333;
        }
        
        .test-content {
            margin: 20px 0;
        }
        
        .test-image {
            max-width: 200px;
            height: auto;
            border-radius: 4px;
        }
        
        .test-bg {
            height: 150px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .test-link {
            color: #0073aa;
            text-decoration: none;
        }
        
        .test-link:hover {
            text-decoration: underline;
        }
        
        .test-shortcode {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 4px;
            border: 1px dashed #ccc;
            text-align: center;
            color: #666;
        }
        
        .test-embed {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 4px;
            border: 1px dashed #ccc;
            text-align: center;
            color: #666;
        }
        
        .instructions {
            background: #e7f3ff;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 30px;
        }
        
        .instructions h3 {
            margin-top: 0;
            color: #005a87;
        }
        
        .instructions ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .instructions li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>MLP Editor Test Page</h1>
        
        <div class="instructions">
            <h3>How to Test the MLP Editor</h3>
            <ul>
                <li><strong>Text Elements:</strong> Click on any text to edit it inline</li>
                <li><strong>Rich Text:</strong> Click on descriptions to edit with formatting options</li>
                <li><strong>Images:</strong> Click on images to change them (simulated)</li>
                <li><strong>Background:</strong> Click on the colored background area</li>
                <li><strong>Links:</strong> Click on links to edit URL and target</li>
                <li><strong>Shortcodes:</strong> Click on shortcode areas to edit</li>
                <li><strong>Embeds:</strong> Click on embed areas to edit</li>
            </ul>
            <p><strong>Note:</strong> This is a frontend-only test. Some features (like image uploads) are simulated.</p>
        </div>
        
        <!-- Text Editor Test -->
        <div class="test-section">
            <h2>Text Editor Test</h2>
            <div class="test-content">
                <h3 data-mlp-id="test-title" data-mlp-type="text">Click to edit this title</h3>
                <p data-mlp-id="test-subtitle" data-mlp-type="text">Click to edit this subtitle text</p>
            </div>
        </div>
        
        <!-- Rich Text Editor Test -->
        <div class="test-section">
            <h2>Rich Text Editor Test</h2>
            <div class="test-content">
                <div data-mlp-id="test-description" data-mlp-type="richtext">
                    <p>This is a <strong>rich text</strong> area that supports <em>formatting</em>.</p>
                    <p>You can add:</p>
                    <ul>
                        <li><strong>Bold text</strong></li>
                        <li><em>Italic text</em></li>
                        <li><a href="#">Links</a></li>
                        <li>Lists</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Image Editor Test -->
        <div class="test-section">
            <h2>Image Editor Test</h2>
            <div class="test-content">
                <img src="https://via.placeholder.com/200x150/0073aa/ffffff?text=Click+to+edit" 
                     alt="Test Image" 
                     class="test-image"
                     data-mlp-id="test-image" 
                     data-mlp-type="image">
                <p>Click the image above to change it (simulated in this test)</p>
            </div>
        </div>
        
        <!-- Background Image Editor Test -->
        <div class="test-section">
            <h2>Background Image Editor Test</h2>
            <div class="test-content">
                <div class="test-bg" 
                     data-mlp-id="test-bg" 
                     data-mlp-type="bg-image">
                    Click to change background
                </div>
            </div>
        </div>
        
        <!-- Link Editor Test -->
        <div class="test-section">
            <h2>Link Editor Test</h2>
            <div class="test-content">
                <a href="https://example.com" 
                   class="test-link"
                   data-mlp-id="test-link" 
                   data-mlp-type="link">
                    Click to edit this link
                </a>
            </div>
        </div>
        
        <!-- Shortcode Editor Test -->
        <div class="test-section">
            <h2>Shortcode Editor Test</h2>
            <div class="test-content">
                <div class="test-shortcode" 
                     data-mlp-id="test-shortcode" 
                     data-mlp-type="shortcode">
                    [trustindex data-widget-id="12345"]
                </div>
            </div>
        </div>
        
        <!-- Embed Editor Test -->
        <div class="test-section">
            <h2>Embed Editor Test</h2>
            <div class="test-content">
                <div class="test-embed" 
                     data-mlp-id="test-embed" 
                     data-mlp-type="embed">
                    YouTube or Instagram embed will appear here
                </div>
            </div>
        </div>
        
        <!-- Save Bar Test -->
        <div class="mlp-save-bar">
            <div class="mlp-save-bar-left">
                <span class="mlp-save-status">Ready to edit</span>
            </div>
            <div class="mlp-save-bar-right">
                <button class="mlp-btn mlp-btn-secondary" onclick="testUndo()">↶ Undo</button>
                <button class="mlp-btn mlp-btn-secondary" onclick="testRedo()">↷ Redo</button>
                <button class="mlp-btn mlp-btn-primary" onclick="testSave()">💾 Save</button>
                <button class="mlp-btn mlp-btn-success" onclick="testSaveAsNew()">📄 Save as New Page</button>
            </div>
        </div>
    </div>
    
    <script>
        // Simulated MLP Editor for testing
        class TestMLPEditor {
            constructor() {
                this.state = {
                    nodes: {},
                    ops: []
                };
                this.init();
            }
            
            init() {
                this.setupEventDelegation();
                this.addEditingIndicators();
            }
            
            setupEventDelegation() {
                document.addEventListener('click', (e) => {
                    const target = e.target.closest('[data-mlp-id]');
                    if (!target) return;
                    
                    const id = target.getAttribute('data-mlp-id');
                    const type = target.getAttribute('data-mlp-type');
                    
                    if (!id || !type) return;
                    
                    this.startEdit(target, id, type);
                });
            }
            
            addEditingIndicators() {
                document.querySelectorAll('[data-mlp-id]').forEach(node => {
                    node.classList.add('mlp-editable');
                    node.setAttribute('tabindex', '0');
                    node.setAttribute('role', 'textbox');
                    
                    if (node.getAttribute('data-mlp-type') === 'richtext') {
                        node.setAttribute('aria-multiline', 'true');
                    }
                });
            }
            
            startEdit(node, id, type) {
                switch (type) {
                    case 'text':
                        this.startTextEdit(node, id);
                        break;
                    case 'richtext':
                        this.startRichTextEdit(node, id);
                        break;
                    case 'image':
                        this.startImageEdit(node, id);
                        break;
                    case 'bg-image':
                        this.startBgImageEdit(node, id);
                        break;
                    case 'link':
                        this.startLinkEdit(node, id);
                        break;
                    case 'shortcode':
                        this.startShortcodeEdit(node, id);
                        break;
                    case 'embed':
                        this.startEmbedEdit(node, id);
                        break;
                }
            }
            
            startTextEdit(node, id) {
                const originalContent = node.textContent.trim();
                node.contentEditable = true;
                node.focus();
                node.classList.add('mlp-editing');
                
                // Select all text
                const range = document.createRange();
                range.selectNodeContents(node);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
                
                this.createTextToolbar(node, () => {
                    const newContent = node.textContent.trim();
                    if (newContent !== originalContent) {
                        this.state.nodes[id] = { kind: 'text', value: newContent };
                        this.showToast('Text updated');
                    }
                    this.endEdit(node);
                }, () => {
                    node.textContent = originalContent;
                    this.endEdit(node);
                });
            }
            
            startRichTextEdit(node, id) {
                const originalContent = node.innerHTML;
                node.contentEditable = true;
                node.focus();
                node.classList.add('mlp-editing');
                
                this.createRichTextToolbar(node, () => {
                    const newContent = node.innerHTML;
                    if (newContent !== originalContent) {
                        this.state.nodes[id] = { kind: 'html', value: newContent };
                        this.showToast('Content updated');
                    }
                    this.endEdit(node);
                }, () => {
                    node.innerHTML = originalContent;
                    this.endEdit(node);
                });
            }
            
            startImageEdit(node, id) {
                this.showToast('Image editor opened (simulated)');
                // In real implementation, this would open WordPress Media Library
            }
            
            startBgImageEdit(node, id) {
                this.showToast('Background image editor opened (simulated)');
                // In real implementation, this would open WordPress Media Library
            }
            
            startLinkEdit(node, id) {
                const currentHref = node.href || '';
                const newHref = prompt('Enter new URL:', currentHref);
                
                if (newHref !== null) {
                    node.href = newHref;
                    this.state.nodes[id] = { kind: 'link', href: newHref, target: '_self' };
                    this.showToast('Link updated');
                }
            }
            
            startShortcodeEdit(node, id) {
                const currentContent = node.textContent.trim();
                const newContent = prompt('Enter shortcode:', currentContent);
                
                if (newContent !== null) {
                    node.textContent = newContent;
                    this.state.nodes[id] = { kind: 'shortcode', value: newContent };
                    this.showToast('Shortcode updated');
                }
            }
            
            startEmbedEdit(node, id) {
                const url = prompt('Enter embed URL (YouTube, Instagram):');
                
                if (url) {
                    node.textContent = `Embed: ${url}`;
                    this.state.nodes[id] = { kind: 'embed', provider: 'youtube', url: url };
                    this.showToast('Embed updated');
                }
            }
            
            createTextToolbar(node, onSave, onCancel) {
                const toolbar = document.createElement('div');
                toolbar.className = 'mlp-text-toolbar';
                toolbar.innerHTML = `
                    <button class="mlp-btn mlp-btn-save" title="Save (Enter)">✓</button>
                    <button class="mlp-btn mlp-btn-cancel" title="Cancel (Esc)">✕</button>
                `;
                
                toolbar.querySelector('.mlp-btn-save').onclick = onSave;
                toolbar.querySelector('.mlp-btn-cancel').onclick = onCancel;
                
                node.parentNode.insertBefore(toolbar, node.nextSibling);
                
                // Keyboard shortcuts
                const handleKeydown = (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        onSave();
                    } else if (e.key === 'Escape') {
                        e.preventDefault();
                        onCancel();
                    }
                };
                
                node.addEventListener('keydown', handleKeydown);
                
                // Store cleanup function
                node._cleanup = () => {
                    node.removeEventListener('keydown', handleKeydown);
                };
            }
            
            createRichTextToolbar(node, onSave, onCancel) {
                const toolbar = document.createElement('div');
                toolbar.className = 'mlp-richtext-toolbar';
                toolbar.innerHTML = `
                    <button class="mlp-btn mlp-btn-bold" title="Bold (Ctrl+B)">B</button>
                    <button class="mlp-btn mlp-btn-italic" title="Italic (Ctrl+I)">I</button>
                    <button class="mlp-btn mlp-btn-link" title="Add Link">🔗</button>
                    <button class="mlp-btn mlp-btn-list" title="Add List">📝</button>
                    <button class="mlp-btn mlp-btn-save" title="Save (Enter)">✓</button>
                    <button class="mlp-btn mlp-btn-cancel" title="Cancel (Esc)">✕</button>
                `;
                
                toolbar.querySelector('.mlp-btn-bold').onclick = () => document.execCommand('bold');
                toolbar.querySelector('.mlp-btn-italic').onclick = () => document.execCommand('italic');
                toolbar.querySelector('.mlp-btn-link').onclick = () => {
                    const url = prompt('Enter URL:');
                    if (url) document.execCommand('createLink', false, url);
                };
                toolbar.querySelector('.mlp-btn-list').onclick = () => document.execCommand('insertUnorderedList');
                toolbar.querySelector('.mlp-btn-save').onclick = onSave;
                toolbar.querySelector('.mlp-btn-cancel').onclick = onCancel;
                
                node.parentNode.insertBefore(toolbar, node.nextSibling);
                
                // Keyboard shortcuts
                const handleKeydown = (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        onSave();
                    } else if (e.key === 'Escape') {
                        e.preventDefault();
                        onCancel();
                    }
                };
                
                node.addEventListener('keydown', handleKeydown);
                
                // Store cleanup function
                node._cleanup = () => {
                    node.removeEventListener('keydown', handleKeydown);
                };
            }
            
            endEdit(node) {
                node.contentEditable = false;
                node.classList.remove('mlp-editing');
                
                // Remove toolbar
                const toolbar = node.parentNode.querySelector('.mlp-text-toolbar, .mlp-richtext-toolbar');
                if (toolbar) toolbar.remove();
                
                // Cleanup event listeners
                if (node._cleanup) {
                    node._cleanup();
                    delete node._cleanup;
                }
            }
            
            showToast(message, type = 'success') {
                const toast = document.createElement('div');
                toast.className = `mlp-toast mlp-toast-${type}`;
                toast.textContent = message;
                toast.setAttribute('aria-live', 'polite');
                
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.classList.add('mlp-toast-show');
                }, 100);
                
                setTimeout(() => {
                    toast.classList.remove('mlp-toast-show');
                    setTimeout(() => {
                        document.body.removeChild(toast);
                    }, 300);
                }, 3000);
            }
        }
        
        // Initialize test editor
        let testEditor;
        
        document.addEventListener('DOMContentLoaded', function() {
            testEditor = new TestMLPEditor();
        });
        
        // Test functions for save bar buttons
        function testUndo() {
            testEditor.showToast('Undo (simulated)');
        }
        
        function testRedo() {
            testEditor.showToast('Redo (simulated)');
        }
        
        function testSave() {
            testEditor.showToast('Saved successfully (simulated)');
        }
        
        function testSaveAsNew() {
            const pageTitle = prompt('Enter page title:');
            if (pageTitle) {
                testEditor.showToast(`Page "${pageTitle}" created successfully! (simulated)`);
            }
        }
        
        // Global keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                testSave();
            } else if ((e.ctrlKey || e.metaKey) && e.key === 'z' && !e.shiftKey) {
                e.preventDefault();
                testUndo();
            } else if ((e.ctrlKey || e.metaKey) && e.key === 'z' && e.shiftKey) {
                e.preventDefault();
                testRedo();
            }
        });
    </script>
</body>
</html>



